# 一、总的思想


网络优化可以从：1、网络json用protuffer代替。

             2、减少http次数。
             
             3、http gzip压缩。

goole开发者大会分享说：最好的网络优化，不是减少网络请求数据等，而是缓存数据

头条的方案是：app先加载本地数据，本地数据可是是sqllite，shareprefer等，显示到屏幕上，同时加载网络数据，然后对显示屏进行刷新。同时用这次网络数据更新本地存储。

## 1、网络优化的维度认知
### 1）、流量消耗
  - 一段时间内流量消耗的精准度量、网络类型、前台后台
  - 监控相关：用户流量消耗均值、异常率（消耗多、次数多）
  - 完整链路全部监控（Request、Response），主动上报
### 2）、网络请求质量
  - 用户体验：请求速度、成功率
  - 监控相关：请求时长、业务成功率、失败率 、失败接口
### 3）、其他
  - 公司成本：带宽、服务器相关
  - 公司成本：带宽、服务器相关

# 二、缓存的使用

okhttp离线缓存实现逻辑，并不能实现二级缓存的功能

# 三、网络优化工具的选择
## 1、Network Profiler
## 2、抓包工具
（window用fiddler抓包，mac用Charles抓包）

fiddler重要的就是抓包，与统计报表，都会反应出哪里耗时，也可以进行弱网测试。
## 3、Stetho

# 三、如何精准获取流量
线上线下流量获取。   

前台后台流量获取。

## 1、如何判断APP流量消耗偏高?
 - 绝对值看不出高低
 - 对比竞品，相同case对比流量消耗
 - 异常监控超过正常指标

## 2、流量异常测试方案推荐
 ### 1）、 设置-----流量管理
    能够查看每个应用的app流量
 ### 2）、抓包工具，抓取APP流量然后统计
    让后一个个的统计每个请求的流量，抓包工具也有统计。可以解决大多数问题，但是线上场景线下可能遇不到
 ### 3）、 线上流量获取方案
  - TrafficStats----API8以上重启以来的流量数据统计
   只统计从上次开机到现在app的流量，TrafficStats----API8以上重启以来的流量数据统计。

  - NetworkStatsManager----API23之后流量统计
    可以获取到指定时间间隔内的流量信息，可以获取到指定时间间隔内的流量信息。
    
  
# 四、前后台流量获取方案总结
前后台流量获取方案总结。

结合精细化的流量异常报警和针对性的解决后台跑流量。

## 1、数据缓存
  - OkHttp,Volley都有较好的支持
      例如okhttp，new Cache后设置到builder中，或者用拦截器 来设置CacheControl的maxAge 等
  - 服务端返回加上过期时间，避免每次重新获取
  - 节约流量且大幅提高数据访问的速度，更好的用户体验

## 2、数据压缩

  - Post请求Body使用GZIP压缩
  - 请求头压缩
  - 图片上传之前必须压缩
## 3、优化请求频率和时机

  - 合并网络请求，减少请求次数
  - 定时上传类型，尽量采取批量+特定场景上传


# 五、线下线上测试相关

## 1、线下测试
  - 侧重点：请求有误、多余、网络切换、弱网、无网测试
## 2、服务端监控
  - 请求耗时（区分地域、时间段、版本、机型）
  - 失败率（业务失败与请求失败）
## 3、客户端监控
  - 请求次数、请求超时率、网络包大小、网络请求失败原因等
  - 图片监控

# 六、网络崩溃优化

 ## 1、崩溃日志的收集
 收集那些信息？
 ### 1）、设别相关的：
  - 设备型号
  - 设备系统类型
  - 设备系统版本
  - 当前使用网络
  - 系统芯片型号
  - 系统架构
### 2）、应用相关
  - 应用版本
  - 崩溃时间
  - 异常内容
## 2、收集的方法
创建一个线程池，运行Thead.setDefaultUncauthExceptionHanlder(),将自定义的ExceptionHandler设置进去，在捕获异常的方法，然后把崩溃日志写入到文本中，然后上传到服务去，大体的思路就是这样。其中要注意一点是，

